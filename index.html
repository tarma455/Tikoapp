<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />

<!-- ğŸ” RECOMENDACIÃ“N OBLIGATORIA -->
<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">

<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>TIKO â€” AutenticaciÃ³n</title>

<!-- Firebase compat -->
<script src="https://www.gstatic.com/firebasejs/9.20.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.20.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.20.0/firebase-firestore-compat.js"></script>

<style>
:root{--accent1:#2563eb;--accent2:#06b6d4;--muted:#6b7280}
body{
margin:0;
background:linear-gradient(180deg,#081b3a,#0f3b6d);
min-height:100vh;
display:flex;
align-items:center;
justify-content:center;
font-family:Arial;
}

.card{
width:100%;
max-width:420px;
padding:20px;
border-radius:18px;
background:linear-gradient(135deg,#ffffff,#dff1ff);
box-shadow:0 10px 30px rgba(0,0,0,.6);
position:relative;
overflow:hidden;
}

.card::before{
content:"ğŸ¶ ğŸ± ğŸ¾ ğŸ©º ğŸ’‰ ğŸ• ğŸˆ";
position:absolute;
inset:0;
display:flex;
justify-content:center;
align-items:center;
font-size:46px;
opacity:.22;
pointer-events:none;
}

h1{text-align:center;margin:0;}
p{text-align:center;color:#555;}

label{font-size:13px;}
input,select{
width:100%;
padding:10px;
margin-top:6px;
border-radius:10px;
border:1px solid #ccc;
}

button{
width:100%;
padding:12px;
border:none;
border-radius:12px;
background:linear-gradient(90deg,#2563eb,#06b6d4);
color:white;
font-weight:bold;
margin-top:12px;
}

.small{text-align:center;margin-top:10px;}
.hidden{display:none}
.ok{color:green}
.err{color:red}
</style>
</head>

<body>

<div class="card">

<h1>T I K O</h1>
<p>ConexiÃ³n Peluda</p>

<!-- LOGIN -->
<div id="loginBox">
<label>Correo</label>
<input id="loginEmail">

<label>ContraseÃ±a</label>
<input id="loginPass" type="password">

<button id="btnLogin">Iniciar sesiÃ³n</button>

<div class="small">
<a href="#" id="showRegister">Crear cuenta</a>
</div>

<div id="loginMsg"></div>
</div>

<!-- REGISTRO -->
<div id="registerBox" class="hidden">

<label>Nombre</label>
<input id="regName">

<label>Correo</label>
<input id="regEmail">

<label>TelÃ©fono</label>
<input id="regPhone">

<label>ContraseÃ±a</label>
<input id="regPass" type="password">

<label>Confirmar</label>
<input id="regConfirm" type="password">

<label>Tipo de cuenta</label>
<select id="regRole">
<option value="usuario">DueÃ±o</option>
<option value="tecnico">TÃ©cnico</option>
<option value="veterinaria">Veterinaria</option>
</select>

<label>CÃ³digo especial (si tienes)</label>
<input id="regCode">

<button id="btnRegister">Registrarme</button>

<div class="small">
<a href="#" id="showLogin">Volver</a>
</div>

<div id="regMsg"></div>

</div>

</div>

<script>
// ğŸ” PEGA AQUÃ TU CONFIG REAL DE FIREBASE
const firebaseConfig = {
  apiKey: "TU_API_KEY",
  authDomain: "TU_PROYECTO.firebaseapp.com",
  projectId: "TU_PROYECTO",
  storageBucket: "TU_PROYECTO.appspot.com",
  messagingSenderId: "XXXX",
  appId: "XXXX"
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();

/* ENVIAR A MIT */
function sendMIT(obj){
 if(window.AppInventor){
   window.AppInventor.setWebViewString(JSON.stringify(obj));
 }
}

/* CAMBIOS DE PANTALLA */
showRegister.onclick = ()=>{
 loginBox.classList.add("hidden");
 registerBox.classList.remove("hidden");
}

showLogin.onclick = ()=>{
 registerBox.classList.add("hidden");
 loginBox.classList.remove("hidden");
}

/* LOGIN */
btnLogin.onclick = async ()=>{
 try{
   const cred = await auth.signInWithEmailAndPassword(
     loginEmail.value,
     loginPass.value
   );

   const doc = await db.collection("usuarios")
   .doc(cred.user.uid).get();

   sendMIT({tipo:"login_ok",datos:doc.data()});

   loginMsg.textContent="Bienvenido";
   loginMsg.className="ok";

 }catch(e){
   loginMsg.textContent=e.message;
   loginMsg.className="err";
 }
}

/* REGISTRO */
btnRegister.onclick = async ()=>{

 if(regPass.value !== regConfirm.value){
   regMsg.textContent="No coinciden";
   regMsg.className="err";
   return;
 }

 try{
   const cred = await auth.createUserWithEmailAndPassword(
     regEmail.value,
     regPass.value
   );

   await db.collection("usuarios")
   .doc(cred.user.uid)
   .set({
     nombre:regName.value,
     email:regEmail.value,
     telefono:regPhone.value,
     rol:regRole.value,
     codigo:regCode.value,
     creado:firebase.firestore.FieldValue.serverTimestamp()
   });

   regMsg.textContent="Cuenta creada";
   regMsg.className="ok";

 }catch(e){
   regMsg.textContent=e.message;
   regMsg.className="err";
 }
}

</script>

</body>
</html>
