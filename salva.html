<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TIKO App</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>

<!-- PDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
body{font-family:sans-serif;background:#f0f4f8;margin:0;padding:20px;text-align:center}
.screen{display:none;max-width:400px;margin:auto;background:white;padding:20px;border-radius:15px;box-shadow:0 4px 10px rgba(0,0,0,.1)}
.active{display:block}
input{width:90%;padding:10px;margin:10px 0;border:1px solid #ccc;border-radius:5px}
button{width:95%;padding:12px;background:#1e3a8a;color:white;border:none;border-radius:5px;font-weight:bold;cursor:pointer;margin-top:10px}
.item{border-bottom:1px solid #eee;padding:10px;display:flex;justify-content:space-between;font-size:14px}
h2{color:#1e3a8a}
</style>
</head>

<body>

<div id="scr-login" class="screen active">
<h2>üêæ TIKO LOGIN</h2>
<input id="login-user" placeholder="Tu Nombre">
<button type="button" onclick="login()">INGRESAR</button>
</div>

<div id="scr-home" class="screen">
<h2>Panel Principal</h2>
<p>Hola, <span id="display-name"></span></p>
<button type="button" onclick="show('scr-mascota')">üê∂ MASCOTA</button>
<button type="button" onclick="show('scr-vacunas')">üíâ VACUNAS</button>
<button type="button" onclick="show('scr-historial')">ü©∫ HISTORIAL</button>
<button type="button" style="background:#2563eb" onclick="renderCartilla()">üìã CARTILLA</button>
<button type="button" style="background:#94a3b8" onclick="location.reload()">SALIR</button>
</div>

<div id="scr-mascota" class="screen">
<h2>Datos Mascota</h2>
<input id="m-nom" placeholder="Nombre Mascota">
<input id="m-esp" placeholder="Especie">
<input id="m-edad" type="number" placeholder="Edad">
<button type="button" onclick="saveMascota()">GUARDAR</button>
<button type="button" style="background:#94a3b8" onclick="show('scr-home')">VOLVER</button>
</div>

<div id="scr-vacunas" class="screen">
<h2>Vacunas</h2>
<input id="v-nom" placeholder="Nombre Vacuna">
<input id="v-fec" type="date">
<button type="button" onclick="addVacuna()">AGREGAR</button>
<div id="list-v"></div>
<button type="button" style="background:#94a3b8" onclick="show('scr-home')">VOLVER</button>
</div>

<div id="scr-historial" class="screen">
<h2>Historial</h2>
<input id="h-enf" placeholder="Enfermedad">
<input id="h-fec" type="date">
<button type="button" onclick="addHistorial()">AGREGAR</button>
<div id="list-h"></div>
<button type="button" style="background:#94a3b8" onclick="show('scr-home')">VOLVER</button>
</div>

<div id="scr-cartilla" class="screen">
<div id="pdf-area">
<h2 style="text-align:center;border-bottom:2px solid #1e3a8a">CARTILLA TIKO</h2>
<div id="c-mascota"></div>
<hr>
<b>VACUNAS</b>
<div id="c-vacunas"></div>
<hr>
<b>HISTORIAL</b>
<div id="c-historial"></div>
</div>
<button type="button" style="background:#10b981" onclick="downloadPDF()">üìÑ PDF</button>
<button type="button" style="background:#94a3b8" onclick="show('scr-home')">VOLVER</button>
</div>

<script>
const firebaseConfig={
apiKey:"AIzaSyANX656iqyz6NIo7WX_IvIMnY4w9SQP6sU",
databaseURL:"https://tiko-ap-default-rtdb.firebaseio.com/",
projectId:"tiko-ap",
appId:"1:97455117291:web:1dc88f792d0a74c394bfae"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.database();
let currentUser="";

function show(id){
document.querySelectorAll('.screen').forEach(s=>s.style.display='none');
document.getElementById(id).style.display='block';
if(id==='scr-vacunas')loadList('vacunas','list-v');
if(id==='scr-historial')loadList('historial','list-h');
}

function login(){
const name=document.getElementById('login-user').value.trim();
if(!name){alert('Escribe tu nombre');return;}
currentUser=name.replace(/\s+/g,'_');
document.getElementById('display-name').innerText=name;
show('scr-home');
}

function saveMascota(){
db.ref(currentUser+'/mascota').set({
nombre:m-nom.value,
especie:m-esp.value,
edad:m-edad.value
}).then(()=>alert('Guardado'));
}

function addVacuna(){
db.ref(currentUser+'/vacunas').push({
nom:v-nom.value,fec:v-fec.value
}).then(()=>{v-nom.value='';loadList('vacunas','list-v')});
}

function addHistorial(){
db.ref(currentUser+'/historial').push({
enf:h-enf.value,fec:h-fec.value
}).then(()=>{h-enf.value='';loadList('historial','list-h')});
}

function loadList(path,div){
db.ref(currentUser+'/'+path).once('value',s=>{
let h='';
s.forEach(c=>{
const d=c.val();
h+=`<div class="item"><span>${d.nom||d.enf}</span><span>${d.fec}</span></div>`;
});
document.getElementById(div).innerHTML=h;
});
}

function renderCartilla(){
db.ref(currentUser).once('value',s=>{
const d=s.val()||{};
const m=d.mascota||{};
c-mascota.innerHTML=`<p>Due√±o: ${currentUser.replace('_',' ')}</p><p>Mascota: ${m.nombre||'-'}</p>`;
c-vacunas.innerHTML='';
c-historial.innerHTML='';
if(d.vacunas)Object.values(d.vacunas).forEach(v=>c-vacunas.innerHTML+=`üíâ ${v.nom} - ${v.fec}<br>`);
if(d.historial)Object.values(d.historial).forEach(h=>c-historial.innerHTML+=`ü©∫ ${h.enf} - ${h.fec}<br>`);
show('scr-cartilla');
});
}

function downloadPDF(){
html2pdf().from(document.getElementById('pdf-area')).save(`TIKO_${currentUser}.pdf`);
}
</script>

</body>
</html>
