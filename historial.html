<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Historial</title>

<script src="https://www.gstatic.com/firebasejs/9.20.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.20.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.20.0/firebase-firestore-compat.js"></script>

<style>
body{
  background:#0f172a;
  color:white;
  font-family:Arial;
  text-align:center;
}
.card{
  background:#1e293b;
  padding:20px;
  margin:20px auto;
  max-width:420px;
  border-radius:15px;
}
ul{padding-left:20px;text-align:left}
</style>
</head>

<body>

<h2>ðŸ“‹ Historial MÃ©dico</h2>

<div class="card">
  <p><b>DueÃ±o:</b> <span id="dueno">â€”</span></p>
  <p><b>Mascota:</b> <span id="mascota">â€”</span></p>

  <h3>ðŸ©º Registros</h3>
  <ul id="lista"></ul>

  <button onclick="window.location.href='home.html'">â¬… Volver</button>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyANX656iqyz6NIo7WX_IvIMnY4w9SQP6sU",
  authDomain: "tiko-ap.firebaseapp.com",
  projectId: "tiko-ap"
};
firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();

auth.onAuthStateChanged(async user=>{
  if(!user) return;

  // DueÃ±o
  const u = await db.collection("usuarios").doc(user.uid).get();
  if(u.exists){
    const d = u.data();
    dueno.innerText = d.nombre || "â€”";
  }

  // Mascota (una por ahora)
  const m = await db.collection("mascotas")
    .where("uid","==",user.uid)
    .limit(1)
    .get();

  if(!m.empty){
    mascota.innerText = m.docs[0].data().nombre;
  }

  // Historial
  const h = await db.collection("historial")
    .where("uid","==",user.uid)
    .get();

  if(h.empty){
    lista.innerHTML="<li>Sin registros</li>";
  }else{
    h.forEach(doc=>{
      const d = doc.data();
      const li = document.createElement("li");
      li.innerText = d.detalle;
      lista.appendChild(li);
    });
  }
});
</script>

</body>
</html>
